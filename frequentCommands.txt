db2 -tf "C:\Users\Paras\Documents\TheoryOfDatabase\homework3\import_zip.sql"

C:\Program Files\IBM\SQLLIB\BIN





!db2se register_spatial_column cse532 -tableSchema cse532 -tableName facility -columnName Geolocation -srsName nad83_srs_1

!db2se register_spatial_column sample -tableName facility -columnName Geolocation -srsName nad83_srs_1


db2 load from "C:\Users\Paras\Documents\TheoryOfDatabase\homework3\Health_Facility_General_Information.csv" of del MESSAGES load.msg INSERT INTO cse532.facilityoriginal

db2 load from "C:\Users\Paras\Documents\TheoryOfDatabase\homework3\Health_Facility_Certification_Information.csv" of del MESSAGES load.msg INSERT INTO cse532.facilitycertification

db2 -tf "C:\Users\Paras\Documents\TheoryOfDatabase\homework3\SpatialDatabase


Also each facility has only one entry regarding Emergency Department inside FacilityCertification table
Those entries can have 0 or non-zero MeasureValue

noerzips.sql
Two types of FacilityCertification entries,
	For a facility does not have Emergency Department entry
	For a facility may have Emergency Department entry with MeasureValue set as 0

 33144
facilities 3831

db2 -td@ -f "C:\Users\Paras\Documents\TheoryOfDatabase\homework3\SpatialDatabase\mergezip.sql"

------------------------------------------------

there are two zip-codes in facility related tables who don't have corresponding shapes available in usz
also there are some rows in facility table having POINT_EMPTY row


SELECT COUNT(DISTINCT SUBSTR(f.ZIPCODE, 1, 5))
FROM CSE532.FACILITY f INNER JOIN CSE532.FACILITYCERTIFICATION fac
ON f.FACILITYID = fac.FACILITYID AND fac.ATTRIBUTEVALUE = 'Emergency Department'
INNER JOIN CSE532.USZIP usz
ON usz.ZCTA5CE10 = SUBSTR(f.ZIPCODE, 1, 5);


SELECT COUNT(DISTINCT SUBSTR(f.ZIPCODE, 1, 5))
FROM CSE532.FACILITY f INNER JOIN CSE532.FACILITYCERTIFICATION fac
ON f.FACILITYID = fac.FACILITYID AND fac.ATTRIBUTEVALUE = 'Emergency Department';

SELECT DISTINCT SUBSTR(f.ZIPCODE, 1, 5)
FROM CSE532.FACILITY f INNER JOIN CSE532.FACILITYCERTIFICATION fac
ON f.FACILITYID = fac.FACILITYID AND fac.ATTRIBUTEVALUE = 'Emergency Department'
LEFT JOIN CSE532.USZIP usz
ON SUBSTR(f.ZIPCODE, 1, 5) = usz.ZCTA5CE10
WHERE usz.ZCTA5CE10 IS NULL;

------------------------------------------------
FACILITY facility-id (cannot create index on this because its' a primary key)
FACILITYCERTIFICATION facility-id, attribute-value
FACILITY GEOLOCATION
USZIP ZCTA5CE10
USZIP SHAPE


in microseconds
before indexing
nearester 864000
noerzips 3926000

after indexing
nearester 450000
noerzips 4242000

------------------------------------------------

steps to mergezip.sql

avg = calculate average population
maintain neighboring zip-codes
iterate on zip-codes
fetch zip-codes 
tables of zip-code relationship, component id
component id, total-population, 


db2 -td@ -f "C:\Users\Paras\Documents\TheoryOfDatabase\homework3\SpatialDatabase\mergezip.sql"

most important command
CREATE USER TEMPORARY TABLESPACE USERTEMPDATA MANAGED BY AUTOMATIC STORAGE;